import Image from "next/image";
import Link from "next/link";
import cn from "classnames";
import styles from "./styles.module.css";
import { deleteCookie } from "cookies-next";
import { useAccount } from "../../web3/hooks";
import { useEffect, useState } from "react";
import axios from "axios";

export default function ProfileCard() {
  const { account } = useAccount();
  const [user, setUser] = useState();

  useEffect(() => {
    if (account?.data) {
      axios
        .post("https://horse-around-app.herokuapp.com/get_user", {
          publicAddress: account?.data,
        })
        .then((res) => {
          setUser(res.data.detail?.user);
        });
    }
  }, [account?.data]);

  const disconnectFunction = () => {
    deleteCookie("access_token");
    window.location.href = "/connectwallet";
  };

  return (
    <div className={cn(styles.card)}>
      <div className={cn(styles.avatarBox)}>
        {user ? (
          <Image
            src={user?.image}
            width={150}
            height={150}
            objectFit="cover"
            className={styles.avatar}
          />
        ) : (
          <div role="status">
            <svg
              aria-hidden="true"
              class="mx-auto w-8 h-8 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600"
              viewBox="0 0 100 101"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
                fill="currentColor"
              />
              <path
                d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
                fill="currentFill"
              />
            </svg>
            <span class="sr-only">Loading...</span>
          </div>
        )}
        <Link href="/profile/edit">
          <div className={styles.editIcon}>
            <svg
              width="37"
              height="36"
              viewBox="0 0 37 36"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M4.75 26.1898V30.7498C4.75 31.1698 5.08 31.4998 5.5 31.4998H10.06C10.255 31.4998 10.45 31.4248 10.585 31.2748L26.965 14.9098L21.34 9.28476L4.975 25.6498C4.825 25.7998 4.75 25.9798 4.75 26.1898ZM31.315 10.5598C31.4541 10.421 31.5644 10.2562 31.6396 10.0747C31.7149 9.89324 31.7537 9.69871 31.7537 9.50226C31.7537 9.30581 31.7149 9.11128 31.6396 8.92982C31.5644 8.74836 31.4541 8.58353 31.315 8.44476L27.805 4.93476C27.6662 4.7957 27.5014 4.68538 27.3199 4.61011C27.1385 4.53484 26.944 4.49609 26.7475 4.49609C26.551 4.49609 26.3565 4.53484 26.1751 4.61011C25.9936 4.68538 25.8288 4.7957 25.69 4.93476L22.945 7.67976L28.57 13.3048L31.315 10.5598V10.5598Z"
                fill="white"
              />
            </svg>
          </div>
        </Link>
      </div>
      <h3 className={cn(styles.userName, "mt-3")}>
        {user ? (
          <Link href={`/owner/${user?.publicAddress}`}>
            <a>{`@${user?.username}`}</a>
          </Link>
        ) : (
          <span>Loading..</span>
        )}
      </h3>
      <span className={styles.userDesc}>{user?.bio}</span>
      <div className={styles.menu}>
        <Link href="/profile/message">
          <a className={styles.navLink}>
            <svg
              width="25"
              height="26"
              viewBox="0 0 25 26"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M22.5 0.500001H2.5C1.12125 0.500001 0 1.6175 0 2.99V18.01C0 19.3825 1.12125 20.5 2.5 20.5H6.25V25.5L14.1887 20.5H22.5C23.8787 20.5 25 19.3825 25 18.01V2.99C24.998 2.32849 24.7337 1.69479 24.265 1.22797C23.7963 0.761143 23.1615 0.499336 22.5 0.500001Z"
                fill="white"
              />
            </svg>
            <span className={styles.navLinkText}>Messages</span>
          </a>
        </Link>
        <Link href="/profile/create">
          <a className={styles.navLink}>
            <svg
              width="25"
              height="20"
              viewBox="0 0 25 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M22.5 2.5H12.5L10.7375 0.7375C10.2625 0.2625 9.625 0 8.9625 0H2.5C1.1125 0 0.0125 1.1125 0.0125 2.5L0 17.5C0 18.8875 1.1125 20 2.5 20H22.5C23.875 20 25 18.875 25 17.5V5C25 3.625 23.875 2.5 22.5 2.5ZM20 12.5H17.5V15C17.5 15.6875 16.9375 16.25 16.25 16.25C15.5625 16.25 15 15.6875 15 15V12.5H12.5C11.8125 12.5 11.25 11.9375 11.25 11.25C11.25 10.5625 11.8125 10 12.5 10H15V7.5C15 6.8125 15.5625 6.25 16.25 6.25C16.9375 6.25 17.5 6.8125 17.5 7.5V10H20C20.6875 10 21.25 10.5625 21.25 11.25C21.25 11.9375 20.6875 12.5 20 12.5Z"
                fill="white"
              />
            </svg>
            <span className={styles.navLinkText}>Create New</span>
          </a>
        </Link>
        <Link href="/profile/setting">
          <a className={styles.navLink}>
            <svg
              width="25"
              height="26"
              viewBox="0 0 25 26"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M21.8768 13C21.8768 12.7125 21.8643 12.4375 21.8393 12.15L24.1643 10.3875C24.6643 10.0125 24.8018 9.3125 24.4893 8.7625L22.1518 4.725C22.0019 4.46023 21.7595 4.26018 21.4711 4.16327C21.1827 4.06637 20.8686 4.07945 20.5893 4.2L17.9018 5.3375C17.4393 5.0125 16.9518 4.725 16.4393 4.4875L16.0768 1.6C16.0018 0.975 15.4643 0.5 14.8393 0.5H10.1768C9.53928 0.5 9.00178 0.975 8.92678 1.6L8.56428 4.4875C8.05178 4.725 7.56428 5.0125 7.10178 5.3375L4.41428 4.2C3.83928 3.95 3.16428 4.175 2.85178 4.725L0.514279 8.775C0.201779 9.325 0.339279 10.0125 0.839279 10.4L3.16428 12.1625C3.11246 12.7238 3.11246 13.2887 3.16428 13.85L0.839279 15.6125C0.339279 15.9875 0.201779 16.6875 0.514279 17.2375L2.85178 21.275C3.16428 21.825 3.83928 22.05 4.41428 21.8L7.10178 20.6625C7.56428 20.9875 8.05178 21.275 8.56428 21.5125L8.92678 24.4C9.00178 25.025 9.53928 25.5 10.1643 25.5H14.8268C15.4518 25.5 15.9893 25.025 16.0643 24.4L16.4268 21.5125C16.9393 21.275 17.4268 20.9875 17.8893 20.6625L20.5768 21.8C21.1518 22.05 21.8268 21.825 22.1393 21.275L24.4768 17.2375C24.7893 16.6875 24.6518 16 24.1518 15.6125L21.8268 13.85C21.8643 13.5625 21.8768 13.2875 21.8768 13ZM12.5518 17.375C10.1393 17.375 8.17678 15.4125 8.17678 13C8.17678 10.5875 10.1393 8.625 12.5518 8.625C14.9643 8.625 16.9268 10.5875 16.9268 13C16.9268 15.4125 14.9643 17.375 12.5518 17.375Z"
                fill="white"
              />
            </svg>
            <span className={styles.navLinkText}>Account Setting</span>
          </a>
        </Link>
        <Link href="">
          <a onClick={disconnectFunction} className={styles.navLink}>
            <svg
              width="31"
              height="30"
              viewBox="0 0 31 30"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M8 2.5H19.25C19.913 2.5 20.5489 2.76339 21.0178 3.23223C21.4866 3.70107 21.75 4.33696 21.75 5V6.25C21.75 6.58152 21.6183 6.89946 21.3839 7.13388C21.1495 7.3683 20.8315 7.5 20.5 7.5C20.1685 7.5 19.8505 7.3683 19.6161 7.13388C19.3817 6.89946 19.25 6.58152 19.25 6.25V5H8V25H19.25V23.75C19.25 23.4185 19.3817 23.1005 19.6161 22.8661C19.8505 22.6317 20.1685 22.5 20.5 22.5C20.8315 22.5 21.1495 22.6317 21.3839 22.8661C21.6183 23.1005 21.75 23.4185 21.75 23.75V25C21.75 25.663 21.4866 26.2989 21.0178 26.7678C20.5489 27.2366 19.913 27.5 19.25 27.5H8C7.33696 27.5 6.70107 27.2366 6.23223 26.7678C5.76339 26.2989 5.5 25.663 5.5 25V5C5.5 4.33696 5.76339 3.70107 6.23223 3.23223C6.70107 2.76339 7.33696 2.5 8 2.5Z"
                fill="white"
              />
              <path
                d="M21.4937 20.3684C21.9812 20.8559 22.7688 20.8559 23.2563 20.3684L27.7412 15.8834C27.9756 15.649 28.1072 15.3311 28.1072 14.9997C28.1072 14.6682 27.9756 14.3503 27.7412 14.1159L23.2563 9.63092C23.0186 9.41616 22.7076 9.30091 22.3874 9.30899C22.0672 9.31707 21.7624 9.44787 21.5359 9.67434C21.3095 9.90082 21.1787 10.2057 21.1706 10.5258C21.1625 10.846 21.2777 11.1571 21.4925 11.3947L23.8375 13.7497H13C12.6685 13.7497 12.3505 13.8814 12.1161 14.1158C11.8817 14.3502 11.75 14.6681 11.75 14.9997C11.75 15.3312 11.8817 15.6491 12.1161 15.8836C12.3505 16.118 12.6685 16.2497 13 16.2497H23.8375L21.4925 18.6047C21.2592 18.8389 21.1283 19.1562 21.1285 19.4868C21.1287 19.8174 21.2601 20.1345 21.4937 20.3684Z"
                fill="white"
              />
            </svg>
            <span className={styles.navLinkText}>Log Out</span>
          </a>
        </Link>
      </div>
    </div>
  );
}
